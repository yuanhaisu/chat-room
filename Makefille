run:
	./recv_server
	./send_server
	./client1
	./client2

build:
	export GO111MODULE=on
	export GOPROXY=https://goproxy.cn
	git mod tidy
	protoc --go_out=plugins=grpc:../ proto/*.proto
	GOOS=linux  GOARCH=amd64 go build -x -o client1 chat_room/cmd/client
	GOOS=linux  GOARCH=amd64 go build -x -o client2 chat_room/cmd/client
	GOOS=linux  GOARCH=amd64 go build -x -o recv_server chat_room/cmd/recv_server
	GOOS=linux  GOARCH=amd64 go build -x -o send_server chat_room/cmd/send_server

prepare:
	yum install -y gcc
	curl -sSL https://get.daocloud.io/docker | sh
	systemctl start docker
	systemctl enable docker
	docker pull redis
	mkdir -p /usr/local/app/redis /usr/local/app/redis/data
	docker run -p 6379:6379 -v /usr/local/app/redis/data:/data -v /usr/local/app/redis/redis.conf:/etc/redis/redis.conf --name redis -d redis redis-server /etc/redis/redis.conf
	docker pull rabbitmq
	mkdir -p /usr/local/app/rabbitmq/conf /usr/local/app/rabbitmq/data
	docker run -d --name rabbitmq -p 5672:5672 -p 15672:15672  -v /usr/local/app/rabbitmq/conf:/etc/rabbitmq -v /usr/local/app/rabbitmq/data:/var/lib/rabbitmq  rabbitmq:3-management

test:
	export GO111MODULE=on
	export GOPROXY=https://goproxy.cn
	go test ./client
	go test ./send_server
	go test ./recv_server